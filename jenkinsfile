pipeline{
   agent any 


stages{

    stage("Git Clone"){
         steps{
             script{
       git credentialsID: 'GIT_HUB_CREDENTIALS' , url: 'https://github.com/anjkulkarni/capstone-project.git'

     }
}
}


stage("Docker build"){
     steps{
        script{
    sh 'sudo docker version'
    sh 'sudo docker build -t capstone/nginx-image:v1.1.0 .'
    sh 'sudo docker images list'
    sh 'sudo docker tag capstone/nginx-image:v1.1.0 anjkulkarni/capstone-project1:capstone'
    }
}
}

stage("Docker Login"){
     steps{
        script{
        withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'PASSWORD')]) {
            sh 'sudo docker login -u anjkulkarni -p $PASSWORD'
        }
    }
}

stage("Push Image to Docker Hub"){
     steps{
        script{
        sh 'sudo docker push  anjkulkarni/capstone-project1:capstone'
    }
}
}

stage('K8S Deploy'){
     steps{
        script{
                kubernetesDeploy(
    
                    configs: 'deployment.yaml',
                    kubeconfigId: '118c61ac-85cc-4677-8d94-e4dc06cc8f12',
                    enableConfigSubstitution: true
                    
        )
        println "starting k8s deployment"
                    sh 'sudo kubectl apply -f deployment.yaml'
                
        }
}
}
}
}
}
